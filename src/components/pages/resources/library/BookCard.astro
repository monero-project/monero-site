---
import Card from "@/components/ui/Card.astro";
import IconLink from "@/components/ui/IconLink.astro";
import bookTextIcon from "@/assets/icons/mask/bookText.avif";
import MaskIcon from "@/components/ui/icons/MaskIcon.astro";
import type { Book } from "@/data/resources/library";
import { Image } from "astro:assets";

export type Props = Book;

const { title, subtitle, description, cover, link, translations } = Astro.props;
const { t } = Astro.locals;

const getLanguageName = (targetLocale: string): string => {
  const displayNames = new Intl.DisplayNames([targetLocale], {
    type: "language",
  });
  const name = displayNames.of(targetLocale);
  return name ? name.charAt(0).toUpperCase() + name.slice(1) : targetLocale;
};
---

<Card as="article" padding="lg" radius="lg" class="book-card">
  <a href={link} class="book-cover" target="_blank" rel="noopener noreferrer">
    {
      cover ? (
        <Image src={cover} alt="" format="avif" />
      ) : (
        <div class="book-placeholder">
          <MaskIcon src={bookTextIcon} size="2rem" />
        </div>
      )
    }
  </a>

  <div class="book-info">
    <div class="book-header">
      <h3 class="book-title">{title}</h3>
      {subtitle && <span class="book-subtitle">{subtitle}</span>}
    </div>

    <p class="book-description">{description}</p>

    <div class="book-footer">
      <IconLink href={link} size="sm">
        {t("common:components.bookCard.readOnline")}
      </IconLink>

      {
        translations && translations.length > 0 && (
          <div class="book-translations">
            <span class="translations-label">
              {t("common:components.bookCard.alsoAvailableIn")}
            </span>
            {translations.map((tr, i) => (
              <>
                <a href={tr.url} target="_blank" rel="noopener noreferrer">
                  {getLanguageName(tr.locale)}
                </a>
                {i < translations.length - 1 && <span class="sep">Â·</span>}
              </>
            ))}
          </div>
        )
      }
    </div>
  </div>
</Card>

<style>
  .book-card {
    display: flex;
    flex-direction: row;
    gap: var(--space-lg);
    min-width: 0;
    overflow: hidden;
  }

  .book-cover {
    display: block;
    width: 150px;
    flex-shrink: 0;
    aspect-ratio: 2 / 3;
    background: var(--background-color);
    border-radius: var(--radius-md);
    overflow: hidden;

    &::after {
      display: none;
    }

    & :global(img) {
      width: 100%;
      height: 100%;
      object-fit: cover;
      transition: transform 0.2s ease;
    }

    &:hover :global(img) {
      transform: scale(1.03);
    }
  }

  .book-placeholder {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 100%;
    height: 100%;
    color: var(--monero-orange);
    opacity: 0.4;
  }

  .book-info {
    display: flex;
    flex-direction: column;
    flex: 1;
    min-width: 0;
  }

  .book-header {
    display: flex;
    flex-direction: column;
    gap: 0.25rem;
    min-width: 0;
  }

  .book-title {
    margin: 0;
    font-size: var(--font-size-lg);
    font-weight: var(--font-weight-bold);
    color: var(--heading-color);
    line-height: var(--line-height-title);
    word-break: break-word;
  }

  .book-subtitle {
    font-size: var(--font-size-sm);
    color: var(--paragraph-subtitle);
    font-weight: var(--font-weight-medium);
  }

  .book-description {
    margin: 0.75rem 0 0;
    font-size: var(--font-size-sm);
    color: var(--paragraph-subtitle);
    line-height: var(--line-height-body);
    overflow: hidden;
    word-break: break-word;
  }

  .book-footer {
    margin-top: auto;
    padding-top: var(--space-sm);
    display: flex;
    flex-wrap: wrap;
    align-items: center;
    gap: var(--space-sm) var(--space-xl);
  }

  .book-translations {
    display: flex;
    flex-wrap: wrap;
    align-items: center;
    gap: var(--space-2xs);
    font-size: var(--font-size-sm);

    .translations-label {
      color: var(--paragraph-subtitle);
    }

    a {
      color: var(--paragraph-main);

      &:hover {
        color: var(--monero-orange);
      }
    }

    .sep {
      color: var(--paragraph-subtitle);
      opacity: 0.5;
    }
  }

  @media (width <= 600px) {
    .book-card {
      flex-direction: column;
      align-items: center;
    }

    .book-cover {
      width: 120px;
    }

    .book-header {
      align-items: center;
    }

    .book-description {
      text-align: start;
    }

    .book-footer,
    .book-translations {
      justify-content: start;
    }
  }
</style>

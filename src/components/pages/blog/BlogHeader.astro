---
import MaskIcon from "@/components/ui/MaskIcon.astro";
import { localizeHref } from "@/i18n/utils";
import type { TFunction } from "i18next";

import calendarIcon from "@/assets/icons/mask/calendar.avif";
import userIcon from "@/assets/icons/mask/user.avif";
import { localizeDateString } from "@/i18n/utils";
import { getDateStringFromId } from "@/utils/blog.ts";

interface Props {
  title: string;
  id: string;
  author: string;
  tags?: string[];
  locale: string;
  t: TFunction;
}

const { title, id, author, tags = [], locale, t } = Astro.props;

const dateString = getDateStringFromId(id);
const date = localizeDateString(dateString, locale, {
  day: "numeric",
  month: "long",
  year: "numeric",
});
---

<div id="post-header">
  <h1>{title}</h1>

  <div id="meta">
    {
      date && (
        <div class="meta-item">
          <div class="icon">
            <MaskIcon src={calendarIcon} />
          </div>
          <time datetime={dateString}>{date}</time>
        </div>
      )
    }

    {
      author && (
        <div class="meta-item">
          <div class="icon">
            <MaskIcon src={userIcon} />
          </div>
          {author.replace(" and ", ` ${t("blog:post.and")} `)}
        </div>
      )
    }
  </div>

  {
    tags.length > 0 && (
      <div class="tag-container">
        {tags.map((tag: string) => (
          <a
            class="tag"
            href={localizeHref(
              locale,
              `/blog/tags/${tag.toLowerCase().replace(/\s+/g, "-")}/`,
            )}
          >
            {t(`blog:tagLabels.${tag}`, { defaultValue: tag })}
          </a>
        ))}
      </div>
    )
  }
</div>

<style lang="scss">
  h1 {
    font-size: var(--font-size-3xl);
    margin: 0;
  }

  #post-header {
    margin-bottom: var(--page-top-margin);
  }

  #meta {
    display: flex;
    flex-direction: row;
    gap: 2rem;
    color: var(--text-secondary);
    margin-top: 1rem;
    margin-bottom: 1.5rem;
    font-size: var(--font-size-lg);
    font-weight: var(--font-weight-normal);
  }

  .meta-item {
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  .meta-item > .icon {
    display: grid;
    place-items: center;
    color: var(--monero-orange);
  }

  .tag-container {
    display: flex;
    gap: 0.5rem;
    font-size: var(--font-size-sm);
    flex-wrap: wrap;
  }

  .tag {
    text-align: center;
    padding: 0.25rem 0.75rem;
    background: var(--footer-color);
    border-radius: 0.5rem;
    text-transform: uppercase;
    font-weight: var(--font-weight-semibold);
    text-decoration: none;
    color: inherit;
    white-space: nowrap;
  }

  .tag:hover {
    color: var(--text-secondary);
  }

  @media (max-width: 600px) {
    #meta {
      flex-direction: column;
      font-size: var(--font-size-md);
      font-weight: var(--font-weight-medium);
      gap: 1rem;
    }

    .meta-item > .icon {
      font-size: var(--font-size-lg);
    }

    .tag-container {
      font-size: var(--font-size-sm);
    }
  }
</style>

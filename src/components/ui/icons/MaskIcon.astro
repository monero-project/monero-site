---
import type { ImageMetadata } from "astro";
import { getImage } from "astro:assets";

export interface Props {
  src: ImageMetadata;
  size?: number | string;
  rtl?: boolean;
  color?: string;
  spacing?: string;
}

const { src, size = "1em", rtl, color = "currentColor", spacing } = Astro.props;

const iconSize = typeof size === "number" ? `${size}px` : size;
const iconSrc = await getImage({ src, format: "avif" }).then(
  (img) => `url(${img.src})`,
);
---

<div class="icon" data-rtl={rtl || undefined}></div>

<style define:vars={{ iconSize, iconSrc, iconColor: color, spacing }}>
  .icon {
    display: inline-block;
    inline-size: var(--iconSize);
    block-size: var(--iconSize);
    margin-inline-start: var(--spacing);
    background: var(--iconColor);
    mask: var(--iconSrc) no-repeat center / contain;

    &[data-rtl] {
      transform: scaleX(-1);
      transform-origin: center;
    }
  }
</style>

---
export interface Props {
  src: string | { src: string };
  darkSrc?: string | { src: string };
  size?: string;
  class?: string;
  rtl?: boolean;
}

const { src, darkSrc, size = "1em", class: className = "", rtl } = Astro.props;

function norm(p: string | { src: string } | unknown): string {
  if (typeof p === "string") return p;
  if (p && typeof p === "object" && "src" in p && typeof p.src === "string")
    return p.src;
  return String(p);
}

const lightUrl = `'${norm(src).replace(/'/g, "\\'")}'`;
const darkUrl = darkSrc ? `'${norm(darkSrc).replace(/'/g, "\\'")}'` : lightUrl;
---

<div class={`icon ${className} ${rtl ? "icon--rtl" : ""}`} aria-hidden="true">
</div>

<style
  define:vars={{
    iconUrlLight: `url(${lightUrl})`,
    iconUrlDark: `url(${darkUrl})`,
    iconSize: size,
  }}
>
  .icon {
    display: inline-block;
    inline-size: var(--iconSize);
    block-size: var(--iconSize);

    aspect-ratio: 1 / 1;
    vertical-align: middle;

    --iconUrl: var(--iconUrlLight);
    background-image: var(--iconUrl);
    background-repeat: no-repeat;
    background-position: center;
    background-size: contain;
  }

  .icon--rtl {
    transform: scaleX(var(-1, 1));
    transform-origin: center;
  }

  @media (prefers-color-scheme: dark) {
    .icon {
      --iconUrl: var(--iconUrlDark);
    }
  }
</style>

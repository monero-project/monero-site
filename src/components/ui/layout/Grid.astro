---
import type { HTMLTag } from "astro/types";

interface Props {
  columns?: 1 | 2 | 3 | 4;
  minWidth?: string;
  gap?: "2xs" | "xs" | "sm" | "md" | "lg" | "xl" | "2xl" | "3xl";
  as?: "div" | "ul" | "ol";
  class?: string;
}

const {
  columns,
  minWidth,
  gap = "lg",
  as = "div",
  class: className,
  ...rest
}: Props = Astro.props;
const Tag = as as HTMLTag;

if (columns && minWidth) {
  throw new Error(
    "Cannot use both columns and minWidth on the same Grid component.",
  );
}

const gridGap = `var(--space-${gap})`;
const gridCols = columns ?? 1;
const gridMinWidth = minWidth ?? "20rem";
---

<Tag
  class:list={["grid", className]}
  data-auto-mode={minWidth ? true : undefined}
  style={`--grid-min-width: ${gridMinWidth}; --grid-gap: ${gridGap}; --grid-cols: ${gridCols};`}
  {...rest}
>
  <slot />
</Tag>

<style>
  .grid {
    display: grid;
    gap: var(--grid-gap);
    grid-template-columns: repeat(var(--grid-cols), 1fr);

    &[data-auto-mode="true"] {
      grid-template-columns: repeat(
        auto-fit,
        minmax(min(var(--grid-min-width), 100%), 1fr)
      );
    }

    &:is(ul, ol) {
      list-style: none;
      margin: 0;
      padding: 0;
    }
  }
</style>

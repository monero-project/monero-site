---
import Layout from "@/layouts/Layout.astro";
import TitleCard from "@/components/ui/TitleCard.astro";
import Tabs from "@/components/ui/Tabs.astro";
import CommunityCard from "@/components/pages/downloads/CommunityCard.astro";
import CoreCard from "@/components/pages/downloads/CoreCard.astro";
import { createTInstance, getLocale } from "@/i18n/utils";
import coreDownloads from "@/data/downloads/core.json";
import communityWallets from "@/data/downloads/community.json";
import type { DownloadLink } from "@/components/pages/downloads/CoreCard.astro";

const locale = getLocale(Astro.url);
const t = await createTInstance(locale, "downloads");
---

<Layout title={t("pageTitle")}>
  <TitleCard title={t("heroTitle")} subtitle={t("heroSubtitle")} />
  <Tabs
    labels={[t("tabs.core"), t("tabs.community")]}
    initial={0}
    id="download-tabs"
  >
    <Fragment slot="panel-0" id="core-tab">
      <div class="downloads-grid">
        <!-- Monero GUI Card -->
        <CoreCard
          image="/media/gui.png"
          imageAlt={t("core.gui.title")}
          title={t("core.gui.title")}
          subtitle={t("core.gui.subtitle")}
          version={coreDownloads.gui.version}
          versionName={coreDownloads.gui.name}
          releaseNotesUrl={`https://github.com/monero-project/monero-gui/releases/tag/${coreDownloads.gui.version}`}
          sourceCodeUrl="https://github.com/monero-project/monero-gui"
          torrentUrl={coreDownloads.gui.torrent}
          magnetUrl={coreDownloads.gui.magnet}
          features={Object.values(
            t("core.gui.features", { returnObjects: true }) as Record<
              string,
              string
            >,
          )}
          downloads={coreDownloads.gui.downloads as DownloadLink[]}
          labels={{
            version: t("core.version"),
            releaseNotes: t("core.releaseNotes"),
            sourceCode: t("core.sourceCode"),
            download: t("core.downloadButton"),
            verifyDownloads: t("core.verifyDownload"),
            verifyDescription: t("core.verifyDescription"),
            viewHashes: t("core.viewHashes"),
          }}
        />

        <!-- Monero CLI Card -->
        <CoreCard
          image="/media/cli.png"
          imageAlt={t("core.cli.title")}
          title={t("core.cli.title")}
          subtitle={t("core.cli.subtitle")}
          version={coreDownloads.cli.version}
          versionName={coreDownloads.cli.name}
          releaseNotesUrl={`https://github.com/monero-project/monero/releases/tag/${coreDownloads.cli.version}`}
          sourceCodeUrl="https://github.com/monero-project/monero"
          torrentUrl={coreDownloads.cli.torrent}
          magnetUrl={coreDownloads.cli.magnet}
          features={Object.values(
            t("core.cli.features", { returnObjects: true }) as Record<
              string,
              string
            >,
          )}
          downloads={coreDownloads.cli.downloads as DownloadLink[]}
          labels={{
            version: t("core.version"),
            releaseNotes: t("core.releaseNotes"),
            sourceCode: t("core.sourceCode"),
            download: t("core.downloadButton"),
            verifyDownloads: t("core.verifyDownload"),
            verifyDescription: t("core.verifyDescription"),
            viewHashes: t("core.viewHashes"),
          }}
        />
      </div>
    </Fragment>

    <Fragment slot="panel-1" id="community-tab">
      <div class="community-section">
        <!-- Local Sync Wallets -->
        <h2 class="section-title">
          {t("community.sections.localSync.title")}
        </h2>
        <p class="section-subtitle">
          {t("community.sections.localSync.subtitle")}
        </p>

        <!-- Monero-only -->
        <h3 class="subheading">{t("community.categories.moneroOnly")}</h3>
        <div class="cards-grid compact">
          {
            communityWallets.localSync.moneroOnly.map((wallet) => (
              <CommunityCard
                logo={wallet.logo}
                name={wallet.name}
                description={t(`community.descriptions.${wallet.id}`)}
                tags={wallet.tags}
                link={wallet.link}
                linkText={t("community.learnMore")}
                translateTag={(key: string) => t(`community.tags.${key}`)}
                t={t}
              />
            ))
          }
        </div>

        <!-- Multi-coin -->
        <h3 class="subheading">{t("community.categories.multiCoin")}</h3>
        <div class="cards-grid compact">
          {
            communityWallets.localSync.multiCoin.map((wallet) => (
              <CommunityCard
                logo={wallet.logo}
                name={wallet.name}
                description={t(`community.descriptions.${wallet.id}`)}
                tags={wallet.tags}
                link={wallet.link}
                linkText={t("community.learnMore")}
                translateTag={(key: string) => t(`community.tags.${key}`)}
                t={t}
              />
            ))
          }
        </div>

        <!-- Remote Sync Wallets -->
        <h2 class="section-title">
          {t("community.sections.remoteSync.title")}
        </h2>
        <p class="section-subtitle">
          {t("community.sections.remoteSync.subtitle")}
        </p>
        <div class="cards-grid">
          {
            communityWallets.remoteSync.map((wallet) => (
              <CommunityCard
                logo={wallet.logo}
                name={wallet.name}
                description={t(`community.descriptions.${wallet.id}`)}
                tags={wallet.tags}
                link={wallet.link}
                linkText={t("community.learnMore")}
                translateTag={(key: string) => t(`community.tags.${key}`)}
                t={t}
              />
            ))
          }
        </div>

        <!-- Offline Wallets -->
        <h2 class="section-title">
          {t("community.sections.offline.title")}
        </h2>
        <p class="section-subtitle">
          {t("community.sections.offline.subtitle")}
        </p>
        <div class="cards-grid">
          {
            communityWallets.offline.map((wallet) => (
              <CommunityCard
                logo={wallet.logo}
                name={wallet.name}
                description={t(`community.descriptions.${wallet.id}`)}
                tags={wallet.tags}
                link={wallet.link}
                linkText={t("community.learnMore")}
                translateTag={(key: string) => t(`community.tags.${key}`)}
                t={t}
              />
            ))
          }
        </div>

        <!-- Node Software -->
        <h2 class="section-title">
          {t("community.sections.nodes.title")}
        </h2>
        <p class="section-subtitle">
          {t("community.sections.nodes.subtitle")}
        </p>
        <div class="cards-grid">
          {
            communityWallets.nodes.map((wallet) => (
              <CommunityCard
                logo={wallet.logo}
                name={wallet.name}
                description={t(`community.descriptions.${wallet.id}`)}
                tags={wallet.tags}
                link={wallet.link}
                linkText={t("community.learnMore")}
                translateTag={(key: string) => t(`community.tags.${key}`)}
                t={t}
              />
            ))
          }
        </div>
      </div>
    </Fragment>
  </Tabs>
</Layout>

<style>
  /* Core downloads */
  .downloads-grid {
    display: grid;
    grid-template-columns: 1fr;
    gap: 1.25rem;
    margin: 2rem 0;
  }

  @media (min-width: 1024px) {
    .downloads-grid {
      gap: 3rem;
    }
  }
</style>

<style>
  /* Community */
  .community-section {
    margin: 2rem 0;
  }

  .section-title {
    font-size: var(--font-size-xl);
    font-weight: var(--font-weight-bold);
    color: var(--heading-color);
    margin: 2rem 0 1rem 0;
  }

  .section-subtitle {
    font-size: var(--font-size-sm);
    color: var(--paragraph-subtitle);
    line-height: var(--line-height-body);
  }

  /* Compact h3 subheadings */
  .subheading {
    font-size: var(--font-size-base);
    font-weight: var(--font-weight-semibold);
    color: var(--heading-color);
    margin: 1.25rem 0 0.25rem 0;
  }

  .cards-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(25rem, 1fr));
    gap: 1.25rem;
    padding: 1rem 0;
  }

  /* Tighter layout for sub-groups */
  .cards-grid.compact {
    grid-template-columns: repeat(auto-fit, minmax(20rem, 1fr));
    padding: 0.5rem 0 1rem 0;
  }

  @media (max-width: 900px) {
    .cards-grid,
    .cards-grid.compact {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
    }
  }
</style>

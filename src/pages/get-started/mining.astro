---
import type { AccordionItemType } from "@/components/ui/Accordion.astro";
import Accordion from "@/components/ui/Accordion.astro";
import ContentCard from "@/components/ui/ContentCard.astro";
import DisclaimerBar from "@/components/ui/DisclaimerBar.astro";
import ExternalResourceButton from "@/components/ui/ExternalResourceButton.astro";
import Grid from "@/components/ui/Grid.astro";
import IconLink from "@/components/ui/IconLink.astro";
import PageContainer from "@/components/ui/PageContainer.astro";
import PageSection from "@/components/ui/PageSection.astro";
import Column from "@/components/ui/Column.astro";
import TitleCard from "@/components/ui/TitleCard.astro";
import Layout from "@/layouts/Layout.astro";

import appWindowIcon from "@/assets/icons/mask/app-window.avif";
import pickaxeIcon from "@/assets/icons/mask/pickaxe.avif";
import shieldIcon from "@/assets/icons/mask/shieldAlert.avif";
import terminalIcon from "@/assets/icons/mask/terminal.avif";

import guiWindow from "@/assets/images/gui.avif";
import gupaxWindow from "@/assets/images/gupax-window.webp";
import xmrigWindow from "@/assets/images/xmrig-window.avif";

const { t, safeMarkdown } = Astro.locals;

// Helper to convert keyed FAQ section to array for Accordion
const faqToItems = (
  faq: Record<string, { title: string; content: string }>,
): AccordionItemType[] => {
  return Object.entries(faq)
    .filter(([key]) => key !== "title") // Exclude the section title
    .map(([, item]) => ({
      title: item.title,
      content: safeMarkdown.parse(item.content),
    }));
};

const faqItems = faqToItems(
  t("mining:faq", { returnObjects: true }) as Record<
    string,
    { title: string; content: string }
  >,
);
---

<Layout title={t("mining:pageTitle")} description={t("mining:description")}>
  <TitleCard
    title={t("mining:hero.title")}
    subtitle={t("mining:hero.subtitle")}
  />
  <PageContainer>
    <PageSection ariaLabel={t("mining:aria.miningOptions")}>
      <Grid columns={3} gap="lg">
        <ContentCard
          title={t("mining:gupax.title")}
          subtitle={t("mining:gupax.subtitle")}
          icon={appWindowIcon}
          image={gupaxWindow}
          imageAlt={t("mining:gupax.imageAlt")}
        >
          <p>{t("mining:gupax.lead")}</p>
          <ul>
            {
              (
                t("mining:gupax.bullets", { returnObjects: true }) as string[]
              ).map((bullet: string) => <li>{bullet}</li>)
            }
          </ul>

          <IconLink slot="bottom" href="https://gupax.io/">
            {t("mining:gupax.cta")}
          </IconLink>
        </ContentCard>

        <ContentCard
          title={t("mining:xmrig.title")}
          subtitle={t("mining:xmrig.subtitle")}
          icon={terminalIcon}
          image={xmrigWindow}
          imageAlt={t("mining:xmrig.imageAlt")}
        >
          <p>{t("mining:xmrig.lead")}</p>
          <ul>
            {
              (
                t("mining:xmrig.bullets", { returnObjects: true }) as string[]
              ).map((bullet: string) => <li>{bullet}</li>)
            }
          </ul>

          <IconLink slot="bottom" href="https://github.com/xmrig/xmrig">
            {t("mining:xmrig.cta")}
          </IconLink>
        </ContentCard>

        <ContentCard
          title={t("mining:solo.title")}
          subtitle={t("mining:solo.subtitle")}
          icon={pickaxeIcon}
          image={guiWindow}
          imageAlt={t("mining:solo.imageAlt")}
        >
          <p>{t("mining:solo.lead")}</p>
          <ul>
            {
              (
                t("mining:solo.bullets", { returnObjects: true }) as string[]
              ).map((bullet: string) => <li>{bullet}</li>)
            }
          </ul>

          <IconLink
            slot="bottom"
            href="https://docs.getmonero.org/interacting/mining/guides/solo/"
          >
            {t("mining:solo.cta")}
          </IconLink>
        </ContentCard>
      </Grid>
    </PageSection>

    <hr aria-hidden="true" />

    <PageSection title={t("mining:resources.title")}>
      <Grid minWidth="16rem" gap="2xl">
        <Column gap="md">
          <h3 class="column-title">{t("mining:resources.guides.title")}</h3>
          <Column as="ul" gap="sm">
            <li>
              <ExternalResourceButton
                href="https://docs.getmonero.org/interacting/mining/guides/pool/xmrig-pool"
                title={t("mining:resources.guides.mineToPool.title")}
                subtitle={t("mining:resources.guides.mineToPool.subtitle")}
                variant="mini"
              />
            </li>
            <li>
              <ExternalResourceButton
                href="https://gupax.io/#guide"
                title={t("mining:resources.guides.gupaxSetup.title")}
                subtitle={t("mining:resources.guides.gupaxSetup.subtitle")}
                variant="mini"
              />
            </li>
          </Column>
        </Column>

        <Column gap="md">
          <h3 class="column-title">{t("mining:resources.pools.title")}</h3>
          <Column as="ul" gap="sm">
            <li>
              <ExternalResourceButton
                href="https://miningpoolstats.stream/monero"
                title={t("mining:resources.pools.comparePools.title")}
                subtitle={t("mining:resources.pools.comparePools.subtitle")}
                variant="mini"
              />
            </li>
          </Column>
        </Column>

        <Column gap="md">
          <h3 class="column-title">{t("mining:resources.benchmarks.title")}</h3>
          <Column as="ul" gap="sm">
            <li>
              <ExternalResourceButton
                href="https://xmrig.com/benchmark"
                title={t("mining:resources.benchmarks.hashrateEstimates.title")}
                subtitle={t(
                  "mining:resources.benchmarks.hashrateEstimates.subtitle",
                )}
                variant="mini"
              />
            </li>
          </Column>
        </Column>
      </Grid>
    </PageSection>

    <hr aria-hidden="true" />

    <PageSection class="faq" title={t("mining:faq.title")}>
      <Accordion variant="card" items={faqItems} />

      <DisclaimerBar icon={shieldIcon} title={t("mining:disclaimer.title")}>
        {t("mining:disclaimer.content")}
      </DisclaimerBar>
    </PageSection>
  </PageContainer>
</Layout>

<style>
  .column-title {
    margin: 0;
    font-size: var(--font-size-base);
    font-weight: var(--font-weight-semibold);
    text-transform: uppercase;
    letter-spacing: 0.02em;
    color: var(--paragraph-main);
  }
</style>

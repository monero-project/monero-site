---
import Layout from "@/layouts/Layout.astro";

import TitleCard from "@/components/ui/TitleCard.astro";
import TOCContainer from "@/components/ui/TOCContainer.astro";

import appWindowIcon from "@/assets/icons/mask/app-window.avif";
import arrowRight from "@/assets/icons/mask/arrow-right.avif";
import bookTextIcon from "@/assets/icons/mask/bookText.avif";
import codeXmlIcon from "@/assets/icons/mask/codeXml.avif";
import crosshairIcon from "@/assets/icons/mask/crosshair.avif";
import externalLinkIcon from "@/assets/icons/mask/external-link.avif";
import globeIcon from "@/assets/icons/mask/globe.avif";
import handCoinsIcon from "@/assets/icons/mask/handCoins.avif";
import heartPlusIcon from "@/assets/icons/mask/heartPlus.avif";
import networkIcon from "@/assets/icons/mask/network.avif";
import pickaxeIcon from "@/assets/icons/mask/pickaxe.avif";
import piggyBankIcon from "@/assets/icons/mask/piggyBank.avif";
import serverIcon from "@/assets/icons/mask/server.avif";
import terminalIcon from "@/assets/icons/mask/terminal.avif";
import usersIcon from "@/assets/icons/mask/users.avif";

import DonationAddress from "@/components/pages/contribute/DonationAddress.astro";
import Button from "@/components/ui/Button.astro";
import ContentCard from "@/components/ui/ContentCard.astro";
import MaskIcon from "@/components/ui/MaskIcon.astro";
import PageContainer from "@/components/ui/PageContainer.astro";
import PageSection from "@/components/ui/PageSection.astro";

import contributingData from "@/data/contributing/contributing.json";

import { createTInstance, getLocale } from "@/i18n/utils";
import { createSafeMarkdown } from "@/utils/safeMarkdown";

const locale = getLocale(Astro.url);
const t = await createTInstance(locale);
const safeMarkdown = createSafeMarkdown(locale);

const sections = [
  {
    id: "supportTheNetwork",
    icon: networkIcon,
    title: t("contribute:sections.supportTheNetwork.title"),
    subtitle: t("contribute:sections.supportTheNetwork.subtitle"),
  },
  {
    id: "develop",
    icon: codeXmlIcon,
    title: t("contribute:sections.develop.title"),
    subtitle: t("contribute:sections.develop.subtitle"),
  },
  {
    id: "donate",
    icon: heartPlusIcon,
    title: t("contribute:sections.donate.title"),
    subtitle: t("contribute:sections.donate.subtitle"),
  },
];

const coreProjects = [
  {
    title: t("contribute:sections.develop.daemon.title"),
    description: t("contribute:sections.develop.daemon.shortDescription"),
    tags: ["C++"],
    href: "https://github.com/monero-project/monero",
    icon: terminalIcon,
  },
  {
    title: t("contribute:sections.develop.guiWallet.title"),
    description: t("contribute:sections.develop.guiWallet.shortDescription"),
    tags: ["C++", "QML"],
    href: "https://github.com/monero-project/monero-gui",
    icon: appWindowIcon,
  },
  {
    title: t("contribute:sections.develop.moneroWebsite.title"),
    description: t(
      "contribute:sections.develop.moneroWebsite.shortDescription",
    ),
    tags: ["Astro", "TypeScript"],
    href: "https://github.com/monero-project/monero-site",
    icon: globeIcon,
  },
  {
    title: t("contribute:sections.develop.moneroDocs.title"),
    description: t("contribute:sections.develop.moneroDocs.shortDescription"),
    tags: ["Markdown"],
    href: "https://github.com/monero-project/monero-docs",
    icon: bookTextIcon,
  },
];
---

<Layout
  title={t("contribute:pageTitle")}
  description={t("contribute:hero.subtitle")}
>
  <TitleCard
    title={t("contribute:hero.title")}
    subtitle={t("contribute:hero.subtitle")}
  />

  <PageContainer>
    <TOCContainer sections={sections} ariaLabel="On this page" />

    <PageSection
      anchorId="supportTheNetwork"
      title={t("contribute:sections.supportTheNetwork.title")}
      subtitle={t("contribute:sections.supportTheNetwork.subtitle")}
    >
      <div class="cardGrid">
        <ContentCard
          title={t("contribute:sections.supportTheNetwork.runANode.title")}
          icon={serverIcon}
        >
          <p>
            {t("contribute:sections.supportTheNetwork.runANode.description")}
          </p>
          <div slot="bottom" class="linkList">
            <span class="linkLabel"
              >{
                t("contribute:sections.supportTheNetwork.runANode.guides")
              }</span
            >
            <a
              href="https://docs.getmonero.org/running-node/monerod-systemd"
              target="_blank"
              rel="noopener"
            >
              {t("contribute:sections.supportTheNetwork.runANode.moneroDocs")}
              <MaskIcon src={arrowRight} size="1em" />
            </a>
            <a
              href="https://sethforprivacy.com/guides/run-a-monero-node/"
              target="_blank"
              rel="noopener"
            >
              {
                t(
                  "contribute:sections.supportTheNetwork.runANode.sethForPrivacy",
                )
              }
              <MaskIcon src={externalLinkIcon} size="1em" />
            </a>
          </div>
        </ContentCard>

        <ContentCard
          title={t("contribute:sections.supportTheNetwork.mine.title")}
          icon={pickaxeIcon}
        >
          <p
            set:html={safeMarkdown.parseInline(
              t("contribute:sections.supportTheNetwork.mine.description"),
            )}
          />
          <div slot="bottom">
            <a href="/get-started/mining/" class="cardLink">
              {t("contribute:sections.supportTheNetwork.mine.learnAboutMining")}
              <MaskIcon src={arrowRight} size="1em" />
            </a>
          </div>
        </ContentCard>
      </div>
    </PageSection>

    <hr aria-hidden="true" />

    <PageSection
      anchorId="develop"
      title={t("contribute:sections.develop.title")}
      subtitle={t("contribute:sections.develop.subtitle")}
    >
      <div class="developGrid">
        <div class="developCard developCard--projects">
          <h3 class="developCardTitle">
            {t("contribute:sections.develop.coreProjects")}
          </h3>
          <div class="projectList">
            {
              coreProjects.map((project) => (
                <a
                  href={project.href}
                  class="projectItem"
                  target="_blank"
                  rel="noopener"
                >
                  <div class="projectIcon">
                    <MaskIcon src={project.icon} size="1.25em" />
                  </div>
                  <div class="projectContent">
                    <div class="projectHeader">
                      <span class="projectName">{project.title}</span>
                      <span class="projectTags">
                        {project.tags.join(" / ")}
                      </span>
                    </div>
                    <span class="projectDescription">
                      {project.description}
                    </span>
                  </div>
                </a>
              ))
            }
          </div>
        </div>

        <ContentCard
          title={t("contribute:sections.develop.workgroups.title")}
          icon={usersIcon}
        >
          <p>{t("contribute:sections.develop.workgroups.description")}</p>
          <div slot="bottom">
            <a href="/community/workgroups/" class="cardLink">
              {t("contribute:sections.develop.workgroups.joinWorkgroups")}
              <MaskIcon src={arrowRight} size="1em" />
            </a>
          </div>
        </ContentCard>
        <ContentCard
          title={t("contribute:sections.develop.bounties.title")}
          icon={crosshairIcon}
        >
          <p>{t("contribute:sections.develop.bounties.description")}</p>
          <div slot="bottom" class="linkList">
            <a
              href="https://bounties.monero.social/"
              target="_blank"
              rel="noopener"
            >
              {t("contribute:sections.develop.bounties.browseMoneroBounties")}
              <MaskIcon src={externalLinkIcon} size="1em" />
            </a>
            <a
              href="https://hackerone.com/monero"
              target="_blank"
              rel="noopener"
            >
              {t("contribute:sections.develop.bounties.securityDisclosures")}
              <MaskIcon src={externalLinkIcon} size="1em" />
            </a>
          </div>
        </ContentCard>
      </div>
    </PageSection>

    <hr aria-hidden="true" />

    <PageSection
      anchorId="donate"
      title={t("contribute:sections.donate.title")}
      subtitle={t("contribute:sections.donate.subtitle")}
    >
      <div class="donateGrid">
        <!-- CCS -->
        <ContentCard
          title={t(
            "contribute:sections.donate.communityCrowdfundingSystem.title",
          )}
          icon={handCoinsIcon}
        >
          <p>
            {
              t(
                "contribute:sections.donate.communityCrowdfundingSystem.description",
              )
            }
          </p>
          <div slot="bottom">
            <Button href="https://ccs.getmonero.org/funding-required/">
              {
                t(
                  "contribute:sections.donate.communityCrowdfundingSystem.viewCcsProposals",
                )
              }
            </Button>
          </div>
        </ContentCard>

        <ContentCard
          title={t("contribute:sections.donate.generalFund.title")}
          icon={piggyBankIcon}
        >
          <p>{t("contribute:sections.donate.generalFund.description")}</p>

          <div class="donationAddresses">
            <DonationAddress
              currency={t("contribute:sections.donate.generalFund.moneroXmr")}
              address={contributingData.xmr.address}
              qrCode={`/media/contributing/${contributingData.xmr.qr_filename}`}
              viewAddress={contributingData.xmr.view_address}
              viewKey={contributingData.xmr.view_key}
              viewOnlyLabel={t(
                "contribute:sections.donate.generalFund.viewOnlyWalletDetails",
              )}
              primaryAddressLabel={t(
                "contribute:sections.donate.generalFund.primaryAddress",
              )}
              viewKeyLabel={t("contribute:sections.donate.generalFund.viewKey")}
            />
            <DonationAddress
              currency={t("contribute:sections.donate.generalFund.bitcoinBtc")}
              address={contributingData.btc.address}
              qrCode={`/media/contributing/${contributingData.btc.qr_filename}`}
            />
          </div>

          <p
            class="finePrint"
            set:html={safeMarkdown.parseInline(
              t("contribute:sections.donate.generalFund.fineprint", {
                openAlias: "donate.getmonero.org",
                email: "dev@getmonero.org",
              }),
            )}
          />
        </ContentCard>
      </div>
    </PageSection>
  </PageContainer>
</Layout>

<style>
  .cardGrid,
  .developGrid,
  .donationAddresses {
    display: grid;
    grid-template-columns: repeat(2, minmax(0, 1fr));
    gap: 1rem;
  }
  .donateGrid {
    display: grid;
    gap: 1rem;
  }
  .developGrid {
    grid-template-rows: auto auto;
  }
  .developCard {
    background: var(--card-color);
    border-radius: 0.75rem;
    padding: 1.25rem;
  }
  .developCard--projects {
    grid-row: span 2;
  }
  .developCardTitle {
    font-size: var(--font-size-lg);
    font-weight: var(--font-weight-bold);
    color: var(--heading-color);
    margin: 0 0 1rem;
  }
  .projectList {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
  }
  .projectItem {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 0.75rem 1rem;
    background: var(--card-hover-color);
    border-radius: 0.5rem;
    text-decoration: none;
    transition: background 0.2s ease;
  }
  .projectItem:hover {
    background: var(--border-color);
  }
  .projectIcon {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 2rem;
    height: 2rem;
    flex-shrink: 0;
    color: var(--heading-color);
  }
  .projectContent {
    flex: 1;
    min-width: 0;
  }
  .projectHeader {
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }
  .projectName {
    font-weight: var(--font-weight-semibold);
    color: var(--heading-color);
  }
  .projectTags,
  .projectDescription {
    color: var(--paragraph-subtitle);
    font-size: var(--font-size-sm);
  }
  .projectTags {
    margin-inline-start: auto;
  }
  .projectDescription {
    display: block;
    margin-top: 0.125rem;
  }

  .linkList {
    display: flex;
    flex-wrap: wrap;
    align-items: center;
    gap: 0.5rem 1rem;
  }
  .linkLabel {
    font-weight: var(--font-weight-semibold);
    color: var(--paragraph-subtitle);
  }
  .linkList a,
  .cardLink {
    display: inline-flex;
    align-items: center;
    gap: 0.35em;
    font-weight: var(--font-weight-semibold);
    color: var(--monero-orange);
    text-decoration: none;
  }
  .linkList a:hover,
  .cardLink:hover {
    text-decoration: underline;
  }

  .finePrint {
    color: var(--paragraph-subtitle);
    margin: 0;
  }

  @media (max-width: 900px) {
    .cardGrid,
    .developGrid,
    .donationAddresses {
      grid-template-columns: minmax(0, 1fr);
    }
    .developCard--projects {
      grid-row: auto;
    }
  }
</style>

---
import Layout from "@/layouts/Layout.astro";

import FeatureCard from "@/components/pages/what-is-monero/FeatureCard.astro";
import UseCaseItem from "@/components/pages/what-is-monero/UseCaseItem.astro";
import { Image } from "astro:assets";

import Row from "@/components/ui/Row.astro";
import CTACard from "@/components/ui/CTACard.astro";
import Grid from "@/components/ui/Grid.astro";
import MediaSection from "@/components/ui/MediaSection.astro";
import PageContainer from "@/components/ui/PageContainer.astro";
import Column from "@/components/ui/Column.astro";
import TitleCard from "@/components/ui/TitleCard.astro";
import VideoContainer from "@/components/ui/VideoContainer.astro";

import communityLogo from "@/assets/images/community-logo.avif";
import cryptoLock from "@/assets/images/crypto-lock.avif";
import surveillanceImage from "@/assets/images/surveillanceImage.avif";

import briefcaseIcon from "@/assets/icons/mask/briefcase.avif";
import coinsIcon from "@/assets/icons/mask/coins.avif";
import eyeOffIcon from "@/assets/icons/mask/eyeOff.avif";
import fistIcon from "@/assets/icons/mask/fist.avif";
import hatGlassesIcon from "@/assets/icons/mask/hat-glasses.avif";
import shieldCheckIcon from "@/assets/icons/mask/shieldCheck.avif";
import shieldPlusIcon from "@/assets/icons/mask/shieldPlus.avif";

import Button from "@/components/ui/Button.astro";
import IconLink from "@/components/ui/IconLink.astro";
import { getLocaleName } from "@/i18n/utils";

import { readdirSync } from "fs";
import { join } from "path";

const { t, localizeHref, safeMarkdown } = Astro.locals;

const i18nVttFiles = readdirSync(
  join(process.cwd(), "public", "media", "vtt", "msmsm"),
)
  .filter((f) => f.endsWith(".vtt") && f !== "en.vtt")
  .map((f) => f.replace(".vtt", ""));

const getLanguageLabel = (lang: string): string => {
  const result = getLocaleName(lang);
  return result ? result.name : lang;
};
---

<Layout
  title={t("what-is-monero:pageTitle")}
  description={t("what-is-monero:hero.subtitle")}
>
  <TitleCard title={t("what-is-monero:hero.title")} />
  <PageContainer>
    <MediaSection as="div" class="content-section">
      <span class="eyebrow">{t("what-is-monero:sections.problem.eyebrow")}</span
      >
      <h2
        set:html={safeMarkdown.parseInline(
          t("what-is-monero:sections.problem.title"),
        )}
      />
      <p
        set:html={safeMarkdown.parseInline(
          t("what-is-monero:sections.problem.content"),
        )}
      />
      <Image slot="aside" src={surveillanceImage} alt="" format="avif" />
    </MediaSection>

    <hr />

    <MediaSection as="div" reverse class="content-section">
      <span class="eyebrow"
        >{t("what-is-monero:sections.solution.eyebrow")}</span
      >
      <h2
        set:html={safeMarkdown.parseInline(
          t("what-is-monero:sections.solution.title"),
        )}
      />
      <p
        set:html={safeMarkdown.parseInline(
          t("what-is-monero:sections.solution.content"),
        )}
      />
      <Image slot="aside" src={cryptoLock} alt="" format="avif" />
    </MediaSection>

    <hr />

    <MediaSection as="div" hideAsideOnMobile={false} class="content-section">
      <Fragment>
        <span class="eyebrow"
          >{t("what-is-monero:sections.useCases.eyebrow")}</span
        >
        <h2>{t("what-is-monero:sections.useCases.title")}</h2>
        <p
          set:html={safeMarkdown.parseInline(
            t("what-is-monero:sections.useCases.intro"),
          )}
        />
      </Fragment>
      <Column slot="aside" gap="2xl">
        <UseCaseItem
          icon={shieldCheckIcon}
          title={t(
            "what-is-monero:sections.useCases.items.financialPrivacy.title",
          )}
          description={t(
            "what-is-monero:sections.useCases.items.financialPrivacy.description",
          )}
        />
        <UseCaseItem
          icon={coinsIcon}
          title={t("what-is-monero:sections.useCases.items.fungibility.title")}
          description={t(
            "what-is-monero:sections.useCases.items.fungibility.description",
          )}
        />
        <UseCaseItem
          icon={fistIcon}
          title={t(
            "what-is-monero:sections.useCases.items.censorshipResistance.title",
          )}
          description={t(
            "what-is-monero:sections.useCases.items.censorshipResistance.description",
          )}
        />
        <UseCaseItem
          icon={briefcaseIcon}
          title={t(
            "what-is-monero:sections.useCases.items.businessPayments.title",
          )}
          description={t(
            "what-is-monero:sections.useCases.items.businessPayments.description",
          )}
        />
      </Column>
    </MediaSection>

    <hr />

    <div class="content-section centered-section">
      <span class="eyebrow"
        >{t("what-is-monero:sections.technology.eyebrow")}</span
      >
      <h2>{t("what-is-monero:sections.technology.title")}</h2>
      <Grid minWidth="20rem" gap="2xl">
        <FeatureCard
          icon={hatGlassesIcon}
          title={t(
            "what-is-monero:sections.technology.features.stealthAddresses.title",
          )}
          description={t(
            "what-is-monero:sections.technology.features.stealthAddresses.description",
          )}
          basedOn={t(
            "what-is-monero:sections.technology.features.stealthAddresses.basedOn",
            {
              mpECDH: localizeHref(
                "/resources/moneropedia/elliptic-curve-diffie-hellman/",
              ),
            },
          )}
        />
        <FeatureCard
          icon={shieldPlusIcon}
          title={t("what-is-monero:sections.technology.features.fcmp.title")}
          description={t(
            "what-is-monero:sections.technology.features.fcmp.description",
          )}
          basedOn={t(
            "what-is-monero:sections.technology.features.fcmp.basedOn",
            {
              mpCurveTrees: localizeHref("/resources/moneropedia/curve-trees/"),
            },
          )}
        />
        <FeatureCard
          icon={eyeOffIcon}
          title={t(
            "what-is-monero:sections.technology.features.confidentialTransactions.title",
          )}
          description={t(
            "what-is-monero:sections.technology.features.confidentialTransactions.description",
          )}
          basedOn={t(
            "what-is-monero:sections.technology.features.confidentialTransactions.basedOn",
            {
              mpPedersenCommitments: localizeHref(
                "/resources/moneropedia/pedersen-commitment/",
              ),
              mpBulletproofs: localizeHref(
                "/resources/moneropedia/bulletproofs/",
              ),
            },
          )}
        />
      </Grid>
    </div>

    <hr />

    <div class="content-section centered-section">
      <span class="eyebrow">{t("what-is-monero:sections.video.eyebrow")}</span>
      <h2>{t("what-is-monero:sections.video.title")}</h2>
      <p>{t("what-is-monero:sections.video.description")}</p>
      <VideoContainer maxWidth="854px" centered class="video-section">
        <video
          width="100%"
          height="100%"
          controls
          preload="none"
          poster="/media/msmsm.webp"
          aria-label={t("what-is-monero:aria.presentationVideo")}
        >
          <source src="/media/msmsm.mp4" type="video/mp4" />
          <track
            kind="captions"
            src="/media/vtt/msmsm/en.vtt"
            srclang="en"
            label="English"
            default
          />
          {
            i18nVttFiles.map((lang) => (
              <track
                kind="captions"
                src={`/media/vtt/msmsm/${lang}.vtt`}
                srclang={lang}
                label={getLanguageLabel(lang)}
              />
            ))
          }
          Your browser does not support the video tag.
        </video>
      </VideoContainer>
    </div>

    <hr />

    <MediaSection as="div" class="content-section">
      <h2>{t("what-is-monero:sections.community.title")}</h2>
      <p
        set:html={safeMarkdown.parseInline(
          t("what-is-monero:sections.community.content", {
            mrlLink: localizeHref("/resources/research-lab/"),
          }),
        )}
      />
      <Row gap="md" class="community-cta-links">
        <IconLink href={localizeHref("/community/hangouts/")} weight="bold">
          {t("what-is-monero:sections.community.joinCommunity")}
        </IconLink>
        <IconLink href={localizeHref("/community/workgroups/")} weight="bold">
          {t("what-is-monero:sections.community.contributeToMonero")}
        </IconLink>
      </Row>
      <Image slot="aside" src={communityLogo} alt="" format="avif" />
    </MediaSection>

    <CTACard
      variant="centered"
      title={t("what-is-monero:sections.cta.title")}
      class="final-cta"
    >
      {t("what-is-monero:sections.cta.subtitle")}
      <Fragment slot="buttons">
        <Button
          variant="primary"
          href={localizeHref("/downloads/community/#wallets")}
        >
          {t("what-is-monero:sections.cta.downloadWallet")}
        </Button>
        <Button
          variant="secondary"
          href={localizeHref("/get-started/exchanges/")}
        >
          {t("what-is-monero:sections.cta.getMonero")}
        </Button>
      </Fragment>
    </CTACard>
  </PageContainer>
</Layout>

<style>
  .eyebrow {
    text-transform: uppercase;
    font-weight: var(--font-weight-semibold);
    color: var(--monero-orange);
    font-size: var(--font-size-sm);
  }

  .content-section {
    margin-block: var(--space-2xl);
  }

  .content-section h2 {
    font-size: var(--font-size-3xl);
    color: var(--heading-color);
    margin-top: var(--space-xs);
  }

  .content-section p {
    font-size: var(--font-size-lg);
    color: var(--paragraph-subtitle);
    line-height: var(--line-height-body);
    max-width: 75ch;
  }

  .centered-section {
    text-align: center;
  }

  .centered-section p {
    margin-inline: auto;
  }

  .video-section {
    margin-top: var(--space-xl);
  }

  .community-cta-links {
    margin-top: var(--space-2xl);
  }

  .final-cta {
    padding-block: var(--space-2xl);
  }

  .final-cta :global(.cta-title) {
    font-size: var(--font-size-3xl);
  }
</style>

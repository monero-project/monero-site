---
import "@/styles/moneropedia-link.css";

import { createTInstance, getLocale } from "@/i18n/utils";
import { createSafeMarkdown } from "@/utils/safeMarkdown";

import Layout from "@/layouts/Layout.astro";

import IndexCard from "@/components/pages/index/IndexCard.astro";
import ResourceCard from "@/components/pages/index/ResourceCard.astro";
import type { AccordionItemType } from "@/components/ui/Accordion.astro";
import Accordion from "@/components/ui/Accordion.astro";
import TitleCard from "@/components/ui/TitleCard.astro";

import developerGuidesIcon from "@/assets/icons/mask/developer-guides.avif";
import faqIcon from "@/assets/icons/mask/faq.avif";
import PageContainer from "@/components/ui/PageContainer.astro";

const locale = getLocale(Astro.url);
const t = await createTInstance(locale);
const safeMarkdown = createSafeMarkdown(locale);

const sectionToItems = (
  section: Record<string, { title: string; content: string }>,
): AccordionItemType[] => {
  return Object.entries(section)
    .filter(([key]) => key !== "title")
    .map(([, item]) => ({
      title: item.title,
      content: safeMarkdown.parse(item.content),
    }));
};

const basicsItems = sectionToItems(
  t("faq:basics", { returnObjects: true }) as Record<
    string,
    { title: string; content: string }
  >,
);
const nodesItems = sectionToItems(
  t("faq:nodes", { returnObjects: true }) as Record<
    string,
    { title: string; content: string }
  >,
);
const privacyItems = sectionToItems(
  t("faq:privacy", { returnObjects: true }) as Record<
    string,
    { title: string; content: string }
  >,
);
const securityItems = sectionToItems(
  t("faq:security", { returnObjects: true }) as Record<
    string,
    { title: string; content: string }
  >,
);
const walletsItems = sectionToItems(
  t("faq:wallets", { returnObjects: true }) as Record<
    string,
    { title: string; content: string }
  >,
);
const economicsItems = sectionToItems(
  t("faq:economics", { returnObjects: true }) as Record<
    string,
    { title: string; content: string }
  >,
);
---

<Layout title={t("faq:pageTitle")} description={t("faq:hero.subtitle")}>
  <TitleCard title={t("faq:hero.title")} subtitle={t("faq:hero.subtitle")} />
  <PageContainer>
    <div class="accordion-grid">
      <div class="accordion-card">
        <h2 class="card-title">{t("faq:basics.title")}</h2>
        <Accordion items={basicsItems} />
      </div>
      <div class="accordion-card">
        <h2 class="card-title">{t("faq:nodes.title")}</h2>
        <Accordion items={nodesItems} />
      </div>
      <div class="accordion-card">
        <h2 class="card-title">{t("faq:privacy.title")}</h2>
        <Accordion items={privacyItems} />
      </div>
      <div class="accordion-card">
        <h2 class="card-title">{t("faq:security.title")}</h2>
        <Accordion items={securityItems} />
      </div>
      <div class="accordion-card">
        <h2 class="card-title">{t("faq:wallets.title")}</h2>
        <Accordion items={walletsItems} />
      </div>
      <div class="accordion-card">
        <h2 class="card-title">{t("faq:economics.title")}</h2>
        <Accordion items={economicsItems} />
      </div>
    </div>
    <IndexCard
      title={t("index:resourcesTitle")}
      description={t("index:resourcesDescription")}
      id="monero-resources"
    >
      <div id="resource-container">
        <ResourceCard
          icon={developerGuidesIcon}
          title={t("faq:additionalResources.moneroDocs.title")}
          description={t("faq:additionalResources.moneroDocs.description")}
          ctaLabel={t("faq:additionalResources.moneroDocs.ctaLabel")}
          ctaHref="https://docs.getmonero.org"
        />
        <ResourceCard
          icon={faqIcon}
          title={t("faq:additionalResources.stackExchange.title")}
          description={t("faq:additionalResources.stackExchange.description")}
          ctaLabel={t("faq:additionalResources.stackExchange.ctaLabel")}
          ctaHref="https://monero.stackexchange.com"
        />
        <ResourceCard
          icon={developerGuidesIcon}
          title={t("faq:additionalResources.reddit.title")}
          description={t("faq:additionalResources.reddit.description")}
          ctaLabel={t("faq:additionalResources.reddit.ctaLabel")}
          ctaHref="https://www.reddit.com/r/MoneroSupport"
        />
        <ResourceCard
          icon={developerGuidesIcon}
          title={t("faq:additionalResources.monerohow.title")}
          description={t("faq:additionalResources.monerohow.description")}
          ctaLabel={t("faq:additionalResources.monerohow.ctaLabel")}
          ctaHref="https://monero.how"
        />
      </div>
    </IndexCard>
  </PageContainer>
</Layout>

<style>
  .accordion-grid {
    display: grid;
    gap: 1.25rem;
    grid-template-columns: 1fr;
    margin-bottom: 2rem;
  }

  .accordion-card {
    background: var(--card-color);
    padding: 1.5rem;
    border-radius: 0.5rem;
  }

  .card-title {
    margin: 0 0 1.5rem;
    font-size: var(--font-size-lg);
    font-weight: var(--font-weight-semibold);
    color: var(--paragraph-main);
    text-transform: uppercase;
  }

  #resource-container {
    display: grid;
    gap: 2rem;
    grid-template-columns: repeat(auto-fit, minmax(18rem, 1fr));
    overflow: hidden;
  }

  @media (min-width: 900px) {
    .accordion-grid {
      grid-template-columns: repeat(2, 1fr);
    }
    .accordion-card {
      padding: 3rem;
    }
    #resource-container {
      grid-column: span 2;
      grid-template-columns: repeat(auto-fit, minmax(25rem, 1fr));
    }
  }
</style>

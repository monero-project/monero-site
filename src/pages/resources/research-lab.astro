---
import PaperCard from "@/components/pages/resources/research-lab/PaperCard.astro";
import Button from "@/components/ui/Button.astro";
import HeroCard from "@/components/ui/HeroCard.astro";
import MaskIcon from "@/components/ui/MaskIcon.astro";
import PageContainer from "@/components/ui/PageContainer.astro";
import PageSection from "@/components/ui/PageSection.astro";
import SectionTabs from "@/components/ui/SectionTabs.astro";
import TitleCard from "@/components/ui/TitleCard.astro";
import Layout from "@/layouts/Layout.astro";

import arrowRightIcon from "@/assets/icons/mask/arrow-right.avif";
import bookTextIcon from "@/assets/icons/mask/bookText.avif";
import externalLinkIcon from "@/assets/icons/mask/external-link.avif";
import hashtagIcon from "@/assets/icons/mask/hashtag.avif";

import mrlLogo from "@/assets/images/mrl-logo.avif";

import {
  createTInstance,
  getDirection,
  getLocale,
  localizeHref,
} from "@/i18n/utils";

const locale = getLocale(Astro.url);
const dir = getDirection(locale);
const t = await createTInstance(locale);

import {
  iacrPapers,
  mrlBulletins,
  otherPapers,
  whitepapers,
} from "@/data/research-lab";

const paperTabs = [
  {
    label: t("knowledge-base:researchLab.papers.tabs.mrlBulletins"),
    count: mrlBulletins.length,
  },
  {
    label: t("knowledge-base:researchLab.papers.tabs.iacr"),
    count: iacrPapers.length,
  },
  {
    label: t("knowledge-base:researchLab.papers.tabs.other"),
    count: otherPapers.length,
  },
];
---

<Layout
  title={t("knowledge-base:researchLab.pageTitle")}
  description={t("knowledge-base:researchLab.subtitle")}
>
  <TitleCard
    title={t("knowledge-base:researchLab.title")}
    subtitle={t("knowledge-base:researchLab.subtitle")}
    backHref={localizeHref(locale, "/resources/knowledge-base/")}
    backLabel={t("knowledge-base:index.title")}
  />

  <PageContainer>
    <HeroCard
      image={mrlLogo}
      imageAlt={t("knowledge-base:researchLab.hero.imageAlt")}
      title={t("knowledge-base:researchLab.hero.title")}
      description={t("knowledge-base:researchLab.hero.description")}
    >
      <Button
        href="https://moneroresearch.info/"
        as="a"
        target="_blank"
        rel="noopener noreferrer"
      >
        MoneroResearch.info
        <MaskIcon src={externalLinkIcon} size="1em" rtl={dir === "rtl"} />
      </Button>
      <Button
        href="https://matrix.to/#/#monero-research-lab:monero.social"
        as="a"
        target="_blank"
        rel="noopener noreferrer"
        variant="secondary"
      >
        Matrix
        <MaskIcon src={externalLinkIcon} size="1em" rtl={dir === "rtl"} />
      </Button>
      <Button
        as="a"
        href="https://web.libera.chat/#monero-research-lab"
        target="_blank"
        rel="noopener noreferrer"
        variant="secondary"
      >
        <MaskIcon src={hashtagIcon} size="0.9em" rtl={dir === "rtl"} />
        IRC
      </Button>
    </HeroCard>

    <hr aria-hidden="true" />

    <PageSection
      title={t("knowledge-base:researchLab.papers.title")}
      subtitle={t("knowledge-base:researchLab.papers.subtitle")}
      anchorId="papers"
    >
      <div class="research-layout">
        <div class="main-content">
          <SectionTabs tabs={paperTabs}>
            <div slot="panel-0" class="papers-grid">
              {
                mrlBulletins.map((paper) => (
                  <PaperCard
                    code={paper.code}
                    title={paper.title}
                    abstract={paper.abstract}
                    url={paper.url}
                    note={paper.note}
                    t={t}
                  />
                ))
              }
            </div>
            <div slot="panel-1" class="papers-grid">
              {
                iacrPapers.map((paper) => (
                  <PaperCard
                    code={paper.code}
                    title={paper.title}
                    abstract={paper.abstract}
                    url={paper.url}
                    note={paper.note}
                    t={t}
                  />
                ))
              }
            </div>
            <div slot="panel-2" class="papers-grid">
              {
                otherPapers.map((paper) => (
                  <PaperCard
                    code={paper.code}
                    title={paper.title}
                    abstract={paper.abstract}
                    url={paper.url}
                    note={paper.note}
                    t={t}
                  />
                ))
              }
            </div>
          </SectionTabs>
        </div>

        <aside class="sidebar">
          <h3 class="sidebar-title">
            {t("knowledge-base:researchLab.whitepapers.title")}
          </h3>
          <p class="sidebar-subtitle">
            {t("knowledge-base:researchLab.whitepapers.subtitle")}
          </p>
          {
            whitepapers.map((paper) => (
              <a
                href={paper.url}
                target="_blank"
                rel="noopener noreferrer"
                class="whitepaper-item"
              >
                <span class="whitepaper-icon">
                  <MaskIcon
                    src={bookTextIcon}
                    size="1.25rem"
                    rtl={dir === "rtl"}
                  />
                </span>
                <span class="whitepaper-title">
                  {t(
                    `knowledge-base:researchLab.whitepapers.items.${paper.id}`,
                  )}
                </span>
                <span class="whitepaper-arrow">
                  <MaskIcon
                    src={arrowRightIcon}
                    size="1em"
                    rtl={dir === "rtl"}
                  />
                </span>
              </a>
            ))
          }
        </aside>
      </div>
    </PageSection>
  </PageContainer>
</Layout>

<style>
  .research-layout {
    display: flex;
    flex-direction: column;
    gap: 2rem;
  }

  .papers-grid {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
  }

  .sidebar {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
    background: var(--card-color);
    border-radius: 0.5rem;
    padding: 1rem;
  }

  .sidebar-title {
    margin: 0;
    font-size: var(--font-size-lg);
    font-weight: var(--font-weight-bold);
    color: var(--heading-color);
  }

  .sidebar-subtitle {
    margin: 0 0 0.5rem;
    font-size: var(--font-size-xs);
    color: var(--paragraph-subtitle);
  }

  .whitepaper-item {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.625rem 0.75rem;
    background: var(--background-color);
    border: 1px solid var(--border-color);
    border-radius: 0.5rem;
    text-decoration: none;
    transition: background 0.15s ease;
  }

  .whitepaper-item::after {
    display: none;
  }

  .whitepaper-item:hover {
    background: var(--card-hover-color);
  }

  .whitepaper-item:hover .whitepaper-arrow {
    opacity: 1;
    color: var(--monero-orange);
  }

  .whitepaper-icon {
    flex-shrink: 0;
    color: var(--monero-orange);
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .whitepaper-title {
    flex: 1;
    font-size: var(--font-size-xs);
    color: var(--heading-color);
  }

  .whitepaper-arrow {
    flex-shrink: 0;
    color: var(--paragraph-subtitle);
    opacity: 0.5;
    transition:
      opacity 0.15s ease,
      color 0.15s ease;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  @media (min-width: 600px) {
    .sidebar {
      padding: 1.5rem;
    }

    .sidebar-title {
      font-size: var(--font-size-xl);
    }

    .sidebar-subtitle {
      font-size: var(--font-size-sm);
    }

    .whitepaper-item {
      padding: 0.75rem 1rem;
      gap: 0.75rem;
    }

    .whitepaper-title {
      font-size: var(--font-size-sm);
    }
  }

  @media (min-width: 1200px) {
    .research-layout {
      flex-direction: row;
      align-items: flex-start;
    }

    .main-content {
      flex: 1;
      min-width: 0;
    }

    .sidebar {
      position: sticky;
      top: 2rem;
      flex: 0 0 20rem;
    }
  }
</style>

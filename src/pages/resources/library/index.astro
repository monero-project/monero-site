---
import BookCard from "@/components/pages/resources/library/BookCard.astro";
import ExternalResourceButton from "@/components/ui/ExternalResourceButton.astro";
import MaskIcon from "@/components/ui/MaskIcon.astro";
import PageContainer from "@/components/ui/PageContainer.astro";
import PageSection from "@/components/ui/PageSection.astro";
import TitleCard from "@/components/ui/TitleCard.astro";
import TOCContainer from "@/components/ui/TOCContainer.astro";
import Layout from "@/layouts/Layout.astro";

import arrowRightIcon from "@/assets/icons/mask/arrow-right.avif";
import bookTextIcon from "@/assets/icons/mask/bookText.avif";
import mailsIcon from "@/assets/icons/mask/mails.avif";
import receiptTextIcon from "@/assets/icons/mask/receiptText.avif";

import { books, cheatsheets, newsletters } from "@/data/library";

const { dir, t, localizeHref } = Astro.locals;

const sections = [
  {
    id: "books",
    icon: bookTextIcon,
    title: t("knowledge-base:library.sections.books.title"),
    subtitle: t("knowledge-base:library.sections.books.tocSubtitle"),
  },
  {
    id: "cheatsheets",
    icon: receiptTextIcon,
    title: t("knowledge-base:library.sections.cheatsheets.title"),
    subtitle: t("knowledge-base:library.sections.cheatsheets.tocSubtitle"),
  },
  {
    id: "newsletters",
    icon: mailsIcon,
    title: t("knowledge-base:library.sections.newsletters.title"),
    subtitle: t("knowledge-base:library.sections.newsletters.tocSubtitle"),
  },
];
---

<Layout
  title={t("knowledge-base:library.pageTitle")}
  description={t("knowledge-base:library.subtitle")}
>
  <TitleCard
    title={t("knowledge-base:library.title")}
    subtitle={t("knowledge-base:library.subtitle")}
    backHref={localizeHref("/resources/knowledge-base/")}
    backLabel={t("knowledge-base:index.title")}
  />

  <PageContainer>
    <TOCContainer
      sections={sections}
      ariaLabel={t("knowledge-base:library.aria.sectionsNav")}
    />
    <PageSection
      title={t("knowledge-base:library.sections.books.title")}
      subtitle={t("knowledge-base:library.sections.books.subtitle")}
      anchorId="books"
    >
      <div class="books-shelf">
        {books.map((book) => <BookCard {...book} />)}
      </div>
    </PageSection>

    <hr aria-hidden="true" />

    <PageSection
      title={t("knowledge-base:library.sections.cheatsheets.title")}
      anchorId="cheatsheets"
    >
      <div class="cheatsheet-intro">
        <h3 class="salmon-title">
          {t("knowledge-base:library.sections.cheatsheets.salmonSeries.title")}
        </h3>
        <p class="section-intro">
          {
            t(
              "knowledge-base:library.sections.cheatsheets.salmonSeries.description",
            )
          }
        </p>
      </div>

      <div class="cheatsheets-grid">
        {
          cheatsheets.map((sheet) => (
            <a
              href={sheet.url}
              target="_blank"
              rel="noopener noreferrer"
              class="cheatsheet-card"
            >
              <div class="cheatsheet-visual">
                <MaskIcon src={receiptTextIcon} size="2.5rem" />
              </div>
              <div class="cheatsheet-content">
                <h4 class="cheatsheet-title">{sheet.title}</h4>
                <p class="cheatsheet-description">{sheet.description}</p>
              </div>
              <div class="cheatsheet-action">
                <MaskIcon
                  src={arrowRightIcon}
                  size="1.25em"
                  rtl={dir === "rtl"}
                />
              </div>
            </a>
          ))
        }
      </div>
    </PageSection>

    <hr aria-hidden="true" />

    <PageSection
      title={t("knowledge-base:library.sections.newsletters.title")}
      subtitle={t("knowledge-base:library.sections.newsletters.subtitle")}
      anchorId="newsletters"
    >
      <div class="newsletters-grid">
        {
          newsletters.map((newsletter) => (
            <ExternalResourceButton
              href={newsletter.url}
              title={newsletter.title}
              subtitle={newsletter.description}
            />
          ))
        }
      </div>
    </PageSection>
  </PageContainer>
</Layout>

<style>
  .section-intro {
    color: var(--paragraph-subtitle);
    margin-block: 0 var(--space-xl);
    max-width: 70ch;
    line-height: var(--line-height-body);
  }

  .books-shelf {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: var(--space-md);
  }

  @media (max-width: 900px) {
    .books-shelf {
      grid-template-columns: 1fr;
    }
  }

  .cheatsheet-intro {
    margin-bottom: var(--space-xl);
  }

  .salmon-title {
    margin-block: var(--space-xs);
    font-size: var(--font-size-lg);
    font-weight: var(--font-weight-semibold);
    color: var(--heading-color);
  }

  .cheatsheets-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(min(16rem, 100%), 1fr));
    gap: var(--space-md);
  }

  .cheatsheet-card {
    display: flex;
    flex-direction: column;
    background: var(--card-color);
    border-radius: var(--radius-md);
    overflow: hidden;
    text-decoration: none;
  }

  .cheatsheet-card:hover {
    background: var(--card-hover-color);
  }

  .cheatsheet-visual {
    background: var(--background-color);
    padding: var(--space-xl);
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--monero-orange);
  }

  .cheatsheet-content {
    flex: 1;
    padding: var(--space-md) var(--space-lg);
  }

  .cheatsheet-title {
    margin: 0 0 var(--space-2xs);
    font-size: var(--font-size-base);
    font-weight: var(--font-weight-semibold);
    color: var(--heading-color);
  }

  .cheatsheet-description {
    margin: 0;
    font-size: var(--font-size-sm);
    color: var(--paragraph-subtitle);
    line-height: var(--line-height-body);
  }

  .cheatsheet-action {
    padding: var(--space-sm) var(--space-lg);
    border-top: 1px solid var(--border-color);
    display: flex;
    align-items: center;
    justify-content: flex-end;
    color: var(--monero-orange);
  }

  .newsletters-grid {
    display: flex;
    flex-direction: column;
    gap: var(--space-sm);
  }

  @media (max-width: 600px) {
    .cheatsheets-grid {
      grid-template-columns: 1fr;
    }
  }
</style>

---
import { createTInstance, getLocale, localizeHref } from "@/i18n/utils";

import Layout from "@/layouts/Layout.astro";

import type { DownloadLink } from "@/components/pages/downloads/CoreCard.astro";
import CoreCard from "@/components/pages/downloads/CoreCard.astro";
import Tabs from "@/components/ui/Tabs.astro";
import TitleCard from "@/components/ui/TitleCard.astro";

import coreDownloads from "@/data/downloads/core.json";

import hashtagIcon from "@/assets/icons/mask/hashtag.avif";
import MaskIcon from "@/components/ui/MaskIcon.astro";

import cliImage from "@/assets/images/cli.avif";
import guiImage from "@/assets/images/gui.avif";

import appWindowIcon from "@/assets/icons/mask/app-window.avif";
import terminalIcon from "@/assets/icons/mask/terminal.avif";

const locale = getLocale(Astro.url);
const t = await createTInstance(locale);

const tabs = [
  { label: t("downloads.tabs.core"), link: localizeHref(locale, "/downloads") },
  {
    label: t("downloads.tabs.community"),
    link: localizeHref(locale, "/downloads/community"),
  },
];

const sections = [
  {
    id: "gui",
    icon: appWindowIcon,
    title: t("downloads.core.gui.title"),
    subtitle: t("downloads.core.gui.subtitle"),
  },
  {
    id: "cli",
    icon: terminalIcon,
    title: t("downloads.core.cli.title"),
    subtitle: t("downloads.core.cli.subtitle"),
  },
];
---

<Layout
  title={t("downloads.pageTitle")}
  description={t("downloads.heroSubtitle")}
>
  <TitleCard
    title={t("downloads.heroTitle")}
    subtitle={t("downloads.heroSubtitle")}
  />
  <Tabs
    labels={tabs.map((tab) => tab.label)}
    links={tabs.map((tab) => tab.link)}
    activeIndex={0}
  />
  <nav class="toc" aria-label={`${t("downloads.tabs.core")}` + " sections"}>
    {
      sections.map((section) => (
        <a class="toc-link" href={`#${section.id}`}>
          <span class="toc-icon">
            <MaskIcon src={section.icon} size="1.5em" aria-hidden="true" />
          </span>
          <div class="content">
            <span class="toc-link-title">{section.title}</span>
            <span class="toc-link-subtitle">{section.subtitle}</span>
          </div>
          <div class="arrow">
            <MaskIcon src={hashtagIcon} size="0.75em" aria-hidden="true" />
          </div>
        </a>
      ))
    }
  </nav>

  <div class="downloads-grid">
    <!-- Monero GUI Card -->
    <CoreCard
      id="gui"
      image={guiImage}
      title={t("downloads.core.gui.title")}
      subtitle={t("downloads.core.gui.subtitle")}
      version={coreDownloads.gui.version}
      versionName={coreDownloads.gui.name}
      releaseNotesUrl={`https://github.com/monero-project/monero-gui/releases/tag/${coreDownloads.gui.version}`}
      sourceCodeUrl="https://github.com/monero-project/monero-gui"
      torrentUrl={coreDownloads.gui.torrent.link}
      magnetUrl={coreDownloads.gui.torrent.magnet}
      features={Object.values(
        t("downloads.core.gui.features", { returnObjects: true }) as Record<
          string,
          string
        >,
      )}
      downloads={coreDownloads.gui.downloads as DownloadLink[]}
      t={t}
    />

    <!-- Monero CLI Card -->
    <CoreCard
      id="cli"
      image={cliImage}
      title={t("downloads.core.cli.title")}
      subtitle={t("downloads.core.cli.subtitle")}
      version={coreDownloads.cli.version}
      versionName={coreDownloads.cli.name}
      releaseNotesUrl={`https://github.com/monero-project/monero/releases/tag/${coreDownloads.cli.version}`}
      sourceCodeUrl="https://github.com/monero-project/monero"
      torrentUrl={coreDownloads.cli.torrent.link}
      magnetUrl={coreDownloads.cli.torrent.magnet}
      features={Object.values(
        t("downloads.core.cli.features", { returnObjects: true }) as Record<
          string,
          string
        >,
      )}
      downloads={coreDownloads.cli.downloads as DownloadLink[]}
      t={t}
    />
  </div>
</Layout>

<style>
  .toc {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(20rem, 1fr));
    flex-direction: row;
    gap: 1rem;
    padding-bottom: 2rem;
    border-bottom: 1px solid var(--border-color);
  }

  .toc-icon {
    color: var(--monero-orange);
  }

  .toc-link {
    position: relative;
    display: flex;
    flex-direction: row;
    align-items: flex-start;
    gap: 1rem;
    color: var(--heading-color);
    text-decoration: none;
    padding: 0.75rem;
    border-radius: 0.5rem;
    border: var(--border-color);
    background: var(--card-color);
  }

  .toc-link .content {
    display: flex;
    flex-direction: column;
  }

  .toc-link:hover,
  .toc-link:focus-visible {
    background: var(--card-hover-color);
  }

  .toc-link-title {
    font-size: var(--font-size-base);
    font-weight: var(--font-weight-semibold);
    color: var(--heading-color);
  }

  .toc-link-subtitle {
    font-size: var(--font-size-sm);
    color: var(--paragraph-subtitle);
    line-height: var(--line-height-caption);
    margin-top: 0.15rem;
  }

  .toc-link .arrow {
    display: flex;
    align-items: flex-start;
    margin-inline-start: auto;
    color: var(--paragraph-subtitle);
  }
  /* Core downloads */
  .downloads-grid {
    margin-top: 2rem;
    display: grid;
    grid-template-columns: 1fr;
    gap: 2rem;
  }
  :global(#gui, #cli) {
    scroll-margin-top: 4rem;
  }

  @media (min-width: 1200px) {
    :global(#gui, #cli) {
      scroll-margin-top: unset;
    }
  }
</style>

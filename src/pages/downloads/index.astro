---
import { createTInstance, getLocale, localizeHref } from "@/i18n/utils";
import { createSafeMarkdown } from "@/utils/safeMarkdown.ts";

import Layout from "@/layouts/Layout.astro";

import type { DownloadLink } from "@/components/pages/downloads/CoreCard.astro";
import CoreCard from "@/components/pages/downloads/CoreCard.astro";
import Tabs from "@/components/ui/Tabs.astro";
import TitleCard from "@/components/ui/TitleCard.astro";

import coreDownloads from "@/data/downloads/core.json";

import cliImage from "@/assets/images/cli.avif";
import guiImage from "@/assets/images/gui.avif";

import PageContainer from "@/components/ui/PageContainer.astro";

const locale = getLocale(Astro.url);
const t = await createTInstance(locale);
const safeMarkdown = createSafeMarkdown();

const tabs = [
  { label: t("downloads:tabs.core"), link: localizeHref(locale, "/downloads") },
  {
    label: t("downloads:tabs.community"),
    link: localizeHref(locale, "/downloads/community"),
  },
];
---

<Layout
  title={t("downloads:pageTitle")}
  description={t("downloads:hero.subtitle")}
>
  <TitleCard
    title={t("downloads:hero.title")}
    subtitle={t("downloads:hero.subtitle")}
  />
  <PageContainer>
    <Tabs
      labels={tabs.map((tab) => tab.label)}
      links={tabs.map((tab) => tab.link)}
      activeIndex={0}
    />
    <div class="downloads-grid">
      <!-- Monero GUI Card -->
      <CoreCard
        id="gui"
        image={guiImage}
        title={t("downloads:core.gui.title")}
        subtitle={t("downloads:core.gui.subtitle")}
        version={coreDownloads.gui.version}
        versionName={coreDownloads.gui.name}
        releaseNotesUrl={`https://github.com/monero-project/monero-gui/releases/tag/${coreDownloads.gui.version}`}
        sourceCodeUrl="https://github.com/monero-project/monero-gui"
        torrentUrl={coreDownloads.gui.torrent.link}
        magnetUrl={coreDownloads.gui.torrent.magnet}
        features={Object.values(
          t("downloads:core.gui.features", { returnObjects: true }) as Record<
            string,
            string
          >,
        )}
        downloads={coreDownloads.gui.downloads as DownloadLink[]}
        t={t}
      />

      <!-- Monero CLI Card -->
      <CoreCard
        id="cli"
        image={cliImage}
        title={t("downloads:core.cli.title")}
        subtitle={t("downloads:core.cli.subtitle")}
        version={coreDownloads.cli.version}
        versionName={coreDownloads.cli.name}
        releaseNotesUrl={`https://github.com/monero-project/monero/releases/tag/${coreDownloads.cli.version}`}
        sourceCodeUrl="https://github.com/monero-project/monero"
        torrentUrl={coreDownloads.cli.torrent.link}
        magnetUrl={coreDownloads.cli.torrent.magnet}
        features={Object.values(
          t("downloads:core.cli.features", { returnObjects: true }) as Record<
            string,
            string
          >,
        )}
        downloads={coreDownloads.cli.downloads as DownloadLink[]}
        t={t}
      />
    </div>

    <div class="verification-section">
      <h2>{t("downloads:core.verifyDownload")}</h2>
      <p
        set:html={safeMarkdown.parse(
          t("downloads:core.verifyDescription", {
            verifyInstructionLink:
              "https://docs.getmonero.org/interacting/verify-monero-binaries",
          }),
        )}
      />
      <a
        href="/downloads/hashes.txt"
        class="verify-link"
        target="_blank"
        rel="noopener noreferrer"
        set:text={t("downloads:core.viewHashes")}
      />
    </div>
  </PageContainer>
</Layout>

<style>
  .downloads-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 1.5rem;
  }

  #gui,
  #cli {
    scroll-margin-top: 6.5rem;
  }

  @media (max-width: 900px) {
    .downloads-grid {
      grid-template-columns: 1fr;
    }
  }

  @media (min-width: 1200px) {
    #gui,
    #cli {
      scroll-margin-top: unset;
    }
  }

  .verification-section {
    margin-top: 2rem;
    padding: 1.5rem;
    background: var(--card-color);
    border-radius: 0.5rem;
    border-end-start-radius: 0;
    border-start-start-radius: 0;
    border-left: 3px solid var(--monero-orange);
  }

  .verification-section h2 {
    font-weight: var(--font-weight-bold);
    color: var(--heading-color);
    margin: 0 0 0.75rem 0;
  }

  .verification-section p {
    font-size: var(--font-size-sm);
    color: var(--paragraph-main);
    margin: 0 0 1rem 0;
    line-height: var(--line-height-body);
  }

  .verify-link {
    display: inline-block;
    color: var(--monero-orange);
    font-weight: var(--font-weight-semibold);
  }
</style>
